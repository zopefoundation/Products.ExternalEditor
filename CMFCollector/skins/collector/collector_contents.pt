<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master">

<span tal:replace="nothing">
  Template description: Batching view of the collector issues.
</span>

<body>

<div metal:fill-slot="header">

  <div metal:use-macro="here/collector_macros/macros/collector_header">
    COLLECTOR HEADER
  </div>

</div>

<div metal:fill-slot="main">

<div tal:condition="not: collector_header_present|nothing">
  <span tal:condition="nothing"> If master has no macro "header"... </span>
  <div metal:use-macro="here/collector_macros/macros/collector_header">
    COLLECTOR HEADER
  </div>

</div>

<!-- This is the desktop area -->
<div class="Desktop"
     tal:define="Batch python:modules['ZTUtils'].Batch;
                 pysutil modules/Products.PythonScripts.standard;
                 strmod modules/string;
                 cap nocall: strmod/capitalize;
                 split nocall: strmod/split;
                 DateTime nocall: modules/DateTime/DateTime;
                 BATCHSIZE python: 10;
                 TITLELEN python: 45;
                 DESCRLEN python: 120;
                 b_start python: request.get('b_start', 0);
                 searching
                    python: (request.get('searching') != 'yep'
                             and (request.set('status',
                                              ['Pending', 'Accepted'])));
                 items here/collector_search;
                 batch python: Batch(items, BATCHSIZE, int(b_start), orphan=0);
                 prev batch/previous;
                 next batch/next|nothing;
                 last_batch python: max(int(here.length()) - BATCHSIZE, 1)">

    <div metal:use-macro="here/collector_macros/macros/issue_batch_nav">
      ISSUE-BATCH NAVIGATION
    </div>

    <table class="FormLayout">

      <tbody tal:repeat="item batch">

        <tr tal:define="global itemattrs python:
                               here.collector_issue_subject_attrs(item);
                        itemurl item/getURL;
                        itemtype item/Type|nothing;
                        icon item/getIcon|item/icon|nothing">

          <td>
             <a href=""
                tal:attributes="href item/getURL">
                <img src="" alt="Issue" border="0"
                     tal:condition="icon"
                     tal:attributes="src icon">
                <span tal:replace="itemtype"
                      tal:condition="not: icon"></span>
            </a>
          </td>

          <td>
            <a href="ITEMURL" tal:attributes="href item/getURL">
              <span tal:replace="item/id">ID</span> </a>
          </td>

          <td NOWRAP>
            <a href="ITEMURL" tal:attributes="href item/getURL">
              <b><span tal:condition="item/Title"
                       tal:replace="python:
                                     item.Title[:TITLELEN]
                                    + (item.Title[TITLELEN:] and '...')">
              TITLE</span></b></a>
          </td>

          <td NOWRAP>
            <span tal:replace="python: '%s/%s'
                                       % (cap(itemattrs['topic']),
                                          cap(itemattrs['classification']))">
              TOPIC/CLASSIFICATION
            </span>
            <span tal:replace="python: '%s/%s'
                                       % (cap(itemattrs['importance']),
                                          cap(itemattrs['severity']))">
              Importance/Severity
            </span>
          </td>

        </tr>
        <tr tal:define="numcmts python: int(itemattrs['action_number'])-1;
                        plrlcmts python: (numcmts != 1) and 's' or '';
                        numuploads python: int(itemattrs['upload_number']);
                        plrluploads python: (numuploads != 1) and 's' or '';
                        secure python: int(itemattrs['security_related'])">
          <td> </td>
          <td> </td>

          <td NOWRAP colspan="2">

            <font color="SECURITY COLOR"
                  tal:attributes="color python: 
                                        (secure and 'brown' or 'black')">
              <em>
                <span tal:content="python: cap(split(item.review_state,
                                                     '_')[0])">
                  STATUS</span>
              </em>
            </font>
              

            From
            <span tal:replace="item/Creator|nothing">SUBMITTER ID</span>
            <span tal:condition="not: item/Creator|nothing">
              <em>???</em></span>

            <span tal:condition="numcmts">
              <span tal:replace="numcmts">NUM COMMENTS</span>
              followup<span tal:replace="plrlcmts">S?</span>
            </span>

            <span tal:condition="not: numcmts"
                  tal:replace="nothing"></span>
            <span tal:condition="numuploads">
              <span tal:replace="numuploads">NUM ARTIFACTS</span>
              upload<span tal:replace="plrluploads">S?
            </span></span><span tal:condition="itemattrs/assigned_to|nothing">,
              Assigned to: 
              <span tal:content="itemattrs/assigned_to">SUPPORTERS</span>
            </span>
          </td>

        </tr>

        <tr tal:define="crdate python: item.created.aCommon();
                        moddate python: item.modified.aCommon()">
          <td> </td>
          <td> </td>
          <td colspan="3">
            Submitted
            <span tal:replace="crdate">CREATEDATE
              </span><span tal:condition="python: crdate != moddate">,
              Last Mod: <span tal:replace="moddate">MODDATE</span>
            </span>
          </td>
        </tr>

        <tr tal:condition="item/Description">
          <td>
          </td>
          <td colspan="7">
            <font color="gray"
                  tal:content="python: item.Description[:DESCRLEN]
                               + (item.Description[DESCRLEN:] and '...')">
              DESCRIPTION</font>
          </td>
        </tr>

      </tbody>

    </table>

    <div metal:use-macro="here/collector_macros/macros/issue_batch_nav">
      ISSUE-BATCH NAVIGATION
    </div>

    <form action="RETURNHERE" method="get"
          tal:attributes="action python: here.absolute_url()
                                         + '/collector_contents'"
          tal:define="uniqueValuesFor python:
                                      here.portal_catalog.uniqueValuesFor">
      <input type="hidden" name="searching" value="yep">

        <table>
          <tr>
            <td colspan="6" align="center">
              <input type="Submit" value="Search">
            </td>
          </tr>
          <tr>
            <td COLSPAN="4">
              <strong>Any text:</strong>
              <input type="text" name="SearchableText" size="40">
            </td>
            <td align="center">
              Security Related:
              <table> <tr><td NOWRAP>
              <input type="radio" name="security_related" value="2"
                     tal:attributes="checked python:
                                 request.get('security_related', '2') == '2'">
                Either
              <input type="radio" name="security_related" value="0"
                     tal:attributes="checked python:
                                 request.get('security_related', 'x') == '0'">
                No
              <input type="radio" name="security_related" value="1"
                     tal:attributes="checked python:
                                 request.get('security_related', 'x') == '1'">
                Yes
                </td></tr></table>
            </td>
          </tr>
          <tr>
            <th align="center"> Status </th>
            <th align="center"> Requester</th>
            <th align="center"> Supporter </th>
          </tr>
          <tr>
            <td align="center">
              <select name="status:list" multiple size="SIZE"
                    tal:define="values here/collector_issue_trim_states"
                    tal:attributes="size python: min(max(len(values), 3), 5)">
                <span tal:repeat="status values">
                  <option value=""
                          tal:attributes="value status;
                                          selected python: status
                                                 in request.get('status', [])"
                          tal:content="status">
                  </option>
                </span>
             </select>
            </td>
            <td align="center">
              <select name="Creator:list" multiple size="SIZE"
                      tal:define="values python: uniqueValuesFor('Creator')"
                      tal:attributes="size python: min(max(len(values), 3), 5)">
                <span tal:repeat="creator values">
                  <option value=""
                          tal:attributes="value creator;
                                          selected python: creator
                                                           in request.get('Creator', [])"
                          tal:content="creator">
                  </option>
                </span>
              </select>
            </td>
            <td align="center">
              <select name="supporters:list" multiple size="SIZE"
                      tal:define="values python: here.supporters"
                      tal:attributes="size python: min(max(len(values), 3), 5)">
                <span tal:repeat="supporter values">
                  <option value=""
                          tal:attributes="value supporter;
                                          selected python: supporter 
                                                           in request.get('supporters', [])"
                          tal:content="supporter">
                  </option>
                </span>
              </select>
            </td>
          </tr>
          <tr>
            <th align="center"> Topic </th>
            <th align="center"> Classification </th>
            <th align="center"> Severity </th>
            <th align="center"> Importance </th>
          </tr>
          <tr>
            <td align="center">
              <select name="topics:list" multiple size="SIZE"
                    tal:define="values python: here.topics"
                    tal:attributes="size python: min(max(len(values), 3), 5)">
                <span tal:repeat="topic values">
                  <option value=""
                          tal:attributes="value topic;
                                          selected python: topic
                                                           in request.get('topics', [])"
                          tal:content="topic">
                  </option>
                </span>
             </select>
            </td>
            <td align="center">
              <select name="classifications:list" multiple size="SIZE"
                      tal:define="values python: here.classifications"
                      tal:attributes="size python: min(max(len(values), 3), 5)">
                <span tal:repeat="classification values">
                  <option value=""
                          tal:attributes="value classification;
                                          selected python: classification
                                                           in request.get('classifications',
                                                                          [])"
                          tal:content="classification">
                  </option>
                </span>
              </select>
            </td>
            <td align="center">
              <select name="importances:list" multiple size="SIZE"
                      tal:define="values python: here.importances"
                      tal:attributes="size python: min(max(len(values), 3), 5)">
                <span tal:repeat="importance values">
                  <option value=""
                          tal:attributes="value importance;
                                          selected python: importance
                                                           in request.get('importances',[])"
                          tal:content="importance">
                  </option>
                </span>
             </select>
          </td>
            <td align="center">
              <select name="severities:list" multiple size="SIZE"
                      tal:define="values python: here.severities"
                      tal:attributes="size python: min(max(len(values), 3), 5)">
                <span tal:repeat="severity values">
                  <option value=""
                          tal:attributes="value severity;
                                          selected python: severity
                                                           in request.get('severities', [])"
                          tal:content="severity">
                  </option>
                </span>
             </select>
          </td>
        </tr>
      </table>

</form>

</div>
</div>
</body>
</html>

